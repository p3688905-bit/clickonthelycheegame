<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¶ºå—è”ææ¨‚ - æ—¥å•–ä¸‰ç™¾é¡†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Q-Style elements and responsiveness */
        body { font-family: 'Inter', sans-serif; background-color: #fef3c7; /* Light creamy yellow background */ }
        .game-container {
            min-height: 85vh; /* Ensure it takes up most of the mobile screen height */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .fruit-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s ease-out, opacity 0.1s ease-out;
            border: 4px solid #fff; /* White border for emphasis */
        }
        .fruit-icon:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        .correct-click {
            background-color: #6ee7b7; /* Emerald 300 for feedback */
            animation: pop 0.2s ease-out;
        }
        .wrong-click {
            background-color: #f87171; /* Red 400 for feedback */
            animation: shake 0.5s;
        }
        /* Fever Mode visual effect */
        .fever-mode {
            background-color: #fffbeb; /* Light gold background */
            transition: background-color 0.5s;
        }

        /* Keyframe animations for Q-Style feedback */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 1s infinite;
        }
        .clarification-list {
            list-style-type: none;
            padding-left: 0;
        }
        .clarification-list li::before {
            content: 'ğŸ‘‰';
            margin-right: 8px;
            font-size: 0.9em;
        }
    </style>
</head>
<body class="p-4 flex flex-col items-center justify-center min-h-screen transition-colors duration-500">

    <div class="w-full max-w-md bg-white rounded-3xl p-4 shadow-2xl game-container flex flex-col">

        <!-- Header and Status Bar -->
        <header class="text-center mb-4">
            <h1 class="text-3xl font-extrabold text-pink-600 mb-1">
                å¶ºå—è”ææ¨‚
            </h1>
            <p id="poem-text" class="text-sm italic text-gray-500 transition-colors duration-500">ç¾…æµ®å±±ä¸‹å››æ™‚æ˜¥</p>
        </header>

        <div class="flex justify-between items-center p-2 bg-pink-100 rounded-xl shadow-inner mb-4">
            <div class="text-center flex-1">
                <p class="text-xs text-pink-700 font-semibold">è”æ (é¡†)</p>
                <p id="litchi-count" class="text-3xl font-black text-pink-800">0</p>
            </div>
            <div class="text-center flex-1">
                <p class="text-xs text-gray-700 font-semibold">é€£æ“Š (Combo)</p>
                <p id="combo-count" class="text-3xl font-black text-orange-600">0</p>
            </div>
            <div class="text-center flex-1">
                <p class="text-xs text-gray-700 font-semibold">ç²¾åŠ›å€¼</p>
                <div class="relative pt-1">
                    <div class="overflow-hidden h-3 mb-4 text-xs flex rounded-lg bg-green-200">
                        <div id="health-bar" style="width:100%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500 rounded-lg transition-all duration-300"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Info / Messages -->
        <div id="game-message" class="text-center h-8 mb-4 text-xl font-bold text-gray-600">
            è«‹å…ˆé–±è®€åœ–æ¨™èªªæ˜ï¼Œç„¶å¾Œé»æ“Šã€Œé–‹å§‹ã€ï¼
        </div>

        <!-- Game Area - Where fruits appear or instructions are shown -->
        <div id="game-area" class="flex-grow bg-white rounded-2xl p-4 border-4 border-dashed border-pink-200 flex flex-wrap justify-center items-center content-center gap-4 transition-colors duration-500">
            <!-- Instructions and Difficulty Form will be populated here by JavaScript on load -->
        </div>

        <!-- Control Buttons -->
        <div class="mt-6 flex justify-center">
            <button id="start-button" class="px-8 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-full text-xl shadow-lg transition-all duration-200 transform hover:scale-105">
                é–‹å§‹ã€Œå¶ºå—æ—¥ã€
            </button>
            <button id="restart-button" class="hidden px-8 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-full text-xl shadow-lg transition-all duration-200 transform hover:scale-105">
                é‡æ–°é–‹å§‹
            </button>
        </div>

    </div>

    <script>
        // Global Constants
        const LITCHI = 'è”æ';
        const LOQUAT = 'ç›§æ©˜';
        const WAX_APPLE = 'æ¥Šæ¢…';
        const FEVER_FRUIT = 'ä»™æœ'; 
        const FRUIT_SEQUENCE = [LITCHI, LOQUAT, WAX_APPLE];
        const MAX_HEALTH = 100;
        const GAME_DURATION_MS = 60000; 
        const FEVER_DURATION_MS = 5000; 
        const ULTIMATE_GOAL_DAYS = 5; // è¨­ç½®çµ‚æ¥µç›®æ¨™å¤©æ•¸ï¼šæˆåŠŸæŒ‘æˆ° 5 å¤©

        // Difficulty Presets
        const DIFFICULTY_PRESETS = {
            leisurely: {
                label: "æ‚ é–’ (å…¥é–€)",
                dailyGoal: 200,
                feverChance: 0.25, // 25% chance
                wrongClickCost: 3,
                description: "è”æç›®æ¨™è¼ƒä½ï¼Œä»™æœå‡ºç¾æ©Ÿç‡é«˜ã€‚é©åˆè¼•é¬†é«”é©—ã€‚",
                color: "text-green-600"
            },
            su_shi: {
                label: "è˜‡è»¾ (æ¨™æº–)",
                dailyGoal: 300,
                feverChance: 0.15, // 15% chance
                wrongClickCost: 5,
                description: "æ—¥å•–ä¸‰ç™¾é¡†ã€‚æŒ‘æˆ°å‡è¡¡é›£åº¦ï¼Œæœ€è²¼è¿‘åŸè©©æ„å¢ƒã€‚",
                color: "text-amber-600"
            },
            challenge: {
                label: "æŒ‘æˆ° (è€ƒé©—)",
                dailyGoal: 450,
                feverChance: 0.05, // 5% chance
                wrongClickCost: 10,
                description: "ç›®æ¨™æ¥µé«˜ï¼Œä»™æœç¨€å°‘ï¼Œèª¤é»æ‡²ç½°åš´å²ã€‚",
                color: "text-red-600"
            }
        };


        // Seasonal Colors for "å››æ™‚æ˜¥" (Spring all four seasons)
        const SEASON_COLORS = [
            'border-emerald-400', // Early Spring Green
            'border-pink-400',    // Blossom Spring Pink
            'border-sky-400',     // Clear Spring Sky
            'border-amber-400'    // Late Spring Harvest Gold
        ];
        const SEASON_TEXTS = [
            'ç¾…æµ®å±±ä¸‹å››æ™‚æ˜¥ (æ—©æ˜¥)', 
            'ç¾…æµ®å±±ä¸‹å››æ™‚æ˜¥ (èŠ±é–‹)', 
            'ç¾…æµ®å±±ä¸‹å››æ™‚æ˜¥ (æ™´æ—¥)', 
            'ç¾…æµ®å±±ä¸‹å››æ™‚æ˜¥ (è±æ”¶)'
        ];

        // DOM Elements
        const litchiCountEl = document.getElementById('litchi-count');
        const comboCountEl = document.getElementById('combo-count');
        const healthBarEl = document.getElementById('health-bar');
        const gameAreaEl = document.getElementById('game-area');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const gameMessageEl = document.getElementById('game-message');
        const poemTextEl = document.getElementById('poem-text');
        const bodyEl = document.body;

        // Game State
        let gameState = {
            isRunning: false,
            litchi: 0,
            combo: 0,
            health: MAX_HEALTH,
            targetFruit: null,
            timer: null,
            day: 0,
            targetIndex: 0,
            isFever: false,
            feverTimer: null,
            // Dynamic Settings based on difficulty
            dailyGoal: DIFFICULTY_PRESETS.su_shi.dailyGoal,
            feverChance: DIFFICULTY_PRESETS.su_shi.feverChance,
            wrongClickCost: DIFFICULTY_PRESETS.su_shi.wrongClickCost,
        };

        // --- Utility Functions ---

        /** Updates the dynamic settings based on the selected difficulty key. */
        function applyDifficultySetting(difficultyKey) {
            const settings = DIFFICULTY_PRESETS[difficultyKey] || DIFFICULTY_PRESETS.su_shi;
            gameState.dailyGoal = settings.dailyGoal;
            gameState.feverChance = settings.feverChance;
            gameState.wrongClickCost = settings.wrongClickCost;
            
            // Update the start button text to reflect the goal
            startButton.textContent = `é–‹å§‹ (ç›®æ¨™: ${gameState.dailyGoal} é¡†)`;
        }

        /** Updates the seasonal theme based on the current day. */
        function updateSeasonalTheme() {
            if (gameState.day === 0) return;
            
            const seasonIndex = (gameState.day - 1) % SEASON_COLORS.length;
            const colorClass = SEASON_COLORS[seasonIndex];
            const seasonText = SEASON_TEXTS[seasonIndex];

            SEASON_COLORS.forEach(cls => gameAreaEl.classList.remove(cls, cls.replace('border', 'text')));
            
            gameAreaEl.classList.add('border-4', 'border-dashed', colorClass);

            poemTextEl.textContent = seasonText;
            
            SEASON_COLORS.forEach(cls => poemTextEl.classList.remove(cls.replace('border', 'text')));
            poemTextEl.classList.add(colorClass.replace('border', 'text'));
        }

        /** Updates all display elements based on the current gameState. */
        function updateUI() {
            litchiCountEl.textContent = gameState.litchi;
            comboCountEl.textContent = gameState.combo;
            healthBarEl.style.width = `${gameState.health}%`;
            healthBarEl.className = `shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center rounded-lg transition-all duration-300 ${gameState.health > 50 ? 'bg-green-500' : gameState.health > 20 ? 'bg-yellow-500' : 'bg-red-500'}`;
            
            if (gameState.isFever) {
                bodyEl.classList.add('fever-mode');
                gameMessageEl.classList.add('text-yellow-600', 'animate-pulse');
            } else {
                bodyEl.classList.remove('fever-mode');
                gameMessageEl.classList.remove('text-yellow-600', 'animate-pulse');
            }
        }

        /** Chooses the next fruit to be the target in the sequence. */
        function getNextTargetFruit() {
            const fruit = FRUIT_SEQUENCE[gameState.targetIndex % FRUIT_SEQUENCE.length];
            gameState.targetIndex++;
            return fruit;
        }

        /** Maps fruit name to Q-style emoji and color for display. */
        function getFruitData(fruitName) {
            switch (fruitName) {
                case LITCHI:
                    return { emoji: 'ğŸ’', color: 'bg-pink-500 hover:bg-pink-600' };
                case LOQUAT:
                    return { emoji: 'ğŸ‘', color: 'bg-amber-400 hover:bg-amber-500' };
                case WAX_APPLE:
                    return { emoji: 'ğŸ«', color: 'bg-indigo-600 hover:bg-indigo-700' };
                case FEVER_FRUIT: 
                    return { emoji: 'âœ¨', color: 'bg-yellow-400 ring-4 ring-yellow-300 animate-pulse' };
                default:
                    return { emoji: 'â“', color: 'bg-gray-500' };
            }
        }

        /** Creates a clickable fruit button element. */
        function createFruitButton(fruitName) {
            const data = getFruitData(fruitName);
            const button = document.createElement('button');
            button.className = `fruit-icon w-20 h-20 sm:w-24 sm:h-24 rounded-full text-5xl font-extrabold shadow-lg ${data.color}`;
            button.dataset.fruit = fruitName;
            button.innerHTML = data.emoji;
            return button;
        }

        /** Spawns the required target fruit and some distractors. */
        function spawnFruits() {
            gameAreaEl.innerHTML = ''; 
            
            if (!gameState.isFever) {
                gameState.targetFruit = getNextTargetFruit();
                gameMessageEl.textContent = `å¿«é»æ“Š ${gameState.targetFruit}ï¼`;
            } else {
                gameMessageEl.textContent = 'ğŸ”¥ğŸ”¥ ç‹‚ç†±ä»™æœæ¨¡å¼! ç‹‚åƒä¸‰ç™¾é¡†! ğŸ”¥ğŸ”¥';
                gameState.targetFruit = null;
            }


            const allFruitsToSpawn = [];
            const distractors = FRUIT_SEQUENCE.filter(f => f !== gameState.targetFruit);

            // 1. Add Fever Fruit (Uses dynamic chance)
            if (Math.random() < gameState.feverChance && !gameState.isFever) {
                allFruitsToSpawn.push(FEVER_FRUIT);
            }
            
            // 2. Add Target Fruit (if not in fever mode)
            if (!gameState.isFever) {
                allFruitsToSpawn.push(gameState.targetFruit);
            }

            // 3. Fill the rest with a mix of all three main fruits
            const totalSlots = 5; 
            while (allFruitsToSpawn.length < totalSlots) {
                const randomFruit = FRUIT_SEQUENCE[Math.floor(Math.random() * FRUIT_SEQUENCE.length)];
                allFruitsToSpawn.push(randomFruit);
            }

            allFruitsToSpawn.sort(() => Math.random() - 0.5);

            allFruitsToSpawn.forEach(fruitName => {
                const button = createFruitButton(fruitName);
                gameAreaEl.appendChild(button);
            });
        }
        
        /** Activates the Fever Mode for a short duration. */
        function activateFeverMode() {
            if (gameState.feverTimer) clearTimeout(gameState.feverTimer);
            
            gameState.isFever = true;
            gameState.targetIndex--; 
            
            gameState.feverTimer = setTimeout(deactivateFeverMode, FEVER_DURATION_MS);
            
            updateUI();
            spawnFruits(); 
        }

        /** Deactivates the Fever Mode. */
        function deactivateFeverMode() {
            gameState.isFever = false;
            gameState.feverTimer = null;
            
            gameMessageEl.textContent = 'ç‹‚ç†±çµæŸï¼Œè«‹æ¢å¾©é †åºé»æ“Šã€‚';
            
            updateUI();
            spawnFruits(); 
        }

        /** Handles fruit click event. */
        function handleFruitClick(event) {
            if (!gameState.isRunning) return;

            const clickedFruit = event.target.closest('.fruit-icon');
            if (!clickedFruit) return;

            const fruitName = clickedFruit.dataset.fruit;

            const applyFeedback = (className) => {
                clickedFruit.classList.add(className);
                setTimeout(() => clickedFruit.classList.remove(className), 300);
            };

            // 1. Check for FEVER FRUIT click
            if (fruitName === FEVER_FRUIT) {
                applyFeedback('correct-click');
                clickedFruit.style.visibility = 'hidden'; 
                if (!gameState.isFever) {
                    activateFeverMode();
                }
                return;
            }

            if (gameState.isFever) {
                // 2. FEVER MODE LOGIC
                applyFeedback('correct-click');
                
                gameState.combo = Math.min(99, gameState.combo + 2); 
                let litchiReward = 5; 
                gameState.litchi += litchiReward;
                
                gameState.health = Math.min(MAX_HEALTH, gameState.health + 1);

            } else if (fruitName === gameState.targetFruit) {
                // 3. NORMAL CORRECT CLICK
                applyFeedback('correct-click');
                gameState.combo++;
                
                let litchiReward = 1;
                if (gameState.combo > 5) litchiReward = 2;
                if (gameState.combo > 10) litchiReward = 3;

                if (fruitName === LITCHI) {
                    gameState.litchi += litchiReward;
                }
                
                if (gameState.combo % 5 === 0 && gameState.combo > 0) {
                     gameState.health = Math.min(MAX_HEALTH, gameState.health + 2);
                }

                spawnFruits(); 

            } else {
                // 4. WRONG CLICK (Uses dynamic cost)
                applyFeedback('wrong-click');
                gameState.combo = 0;
                gameState.health = Math.max(0, gameState.health - gameState.wrongClickCost); // Use dynamic cost
                gameMessageEl.textContent = `âŒ é€£æ“Šä¸­æ–·! (ç²¾åŠ› -${gameState.wrongClickCost})`;
                
                if (gameState.health === 0) {
                    endGame('ç²¾åŠ›è€—ç›¡');
                }
            }

            updateUI();
        }

        /** Starts the main game loop. */
        function startGame() {
            // Apply the currently selected difficulty settings just in case
            const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked');
            if(selectedDifficulty) {
                applyDifficultySetting(selectedDifficulty.value);
            }
            
            gameState.litchi = 0;
            gameState.combo = 0;
            gameState.health = MAX_HEALTH;
            gameState.isRunning = true;
            gameState.day++;
            gameState.targetIndex = 0;
            gameState.isFever = false;
            clearTimeout(gameState.feverTimer);

            startButton.classList.add('hidden');
            restartButton.classList.add('hidden');
            gameAreaEl.addEventListener('click', handleFruitClick);

            gameMessageEl.textContent = `ç¬¬ ${gameState.day} å€‹å¶ºå—æ—¥é–‹å§‹ï¼ç›®æ¨™: ${gameState.dailyGoal} é¡†`;

            updateSeasonalTheme();
            spawnFruits();
            updateUI();

            gameState.timer = setTimeout(() => {
                checkDailyGoal();
            }, GAME_DURATION_MS);
        }

        /** Checks the daily goal and proceeds or ends the game. */
        function checkDailyGoal() {
            if (!gameState.isRunning) return;

            gameAreaEl.removeEventListener('click', handleFruitClick);
            clearTimeout(gameState.timer);
            clearTimeout(gameState.feverTimer);
            gameState.isRunning = false;
            gameState.isFever = false;

            if (gameState.litchi >= gameState.dailyGoal) {
                
                if (gameState.day >= ULTIMATE_GOAL_DAYS) {
                    // é”æˆçµ‚æ¥µç›®æ¨™
                    gameMessageEl.textContent = `ğŸ† æ­å–œæ‚¨ï¼é”æˆã€Œé•·ä½œå¶ºå—äººã€çš„ç›®æ¨™ï¼`;
                    endGame('æˆåŠŸé”æˆç›®æ¨™'); 
                    return;
                }
                
                gameMessageEl.textContent = `ğŸ‰ å¤ªæ£’äº†ï¼ä»Šå¤©åƒè¶³ ${gameState.litchi} é¡†è”æï¼`;
                
                startButton.textContent = `ç¹¼çºŒæŒ‘æˆ°ç¬¬ ${gameState.day + 1} æ—¥`;
                startButton.classList.remove('hidden');
            } else {
                endGame(`æœªèƒ½é”æˆæ¯æ—¥ ${gameState.dailyGoal} é¡†è”æçš„ç›®æ¨™ã€‚`);
            }
        }

        /** Ends the game and displays final results. */
        function endGame(reason) {
            clearTimeout(gameState.timer);
            clearTimeout(gameState.feverTimer);
            gameState.isRunning = false;
            gameState.isFever = false;
            gameAreaEl.removeEventListener('click', handleFruitClick);
            
            let finalMessage = '';
            
            if (reason === 'æˆåŠŸé”æˆç›®æ¨™') {
                finalMessage = `
                    <p class="text-3xl font-black text-yellow-600 mb-2">ğŸ‰ æœ€çµ‚å‹åˆ©ï¼</p>
                    <p class="text-xl text-yellow-800 mb-4">ğŸ† ä¸è¾­é•·ä½œå¶ºå—äºº ğŸ†</p>
                    <p class="text-lg">æ‚¨å·²æˆåŠŸæŒ‘æˆ° <span class="text-2xl font-extrabold text-pink-600">${gameState.day}</span> å€‹å¶ºå—æ—¥ï¼</p>
                    <p class="text-lg">ç¸½è”ææ•¸: <span class="text-2xl font-extrabold text-pink-600">${gameState.litchi}</span> é¡†</p>
                    <p class="text-sm mt-4 text-gray-500">ï¼ˆåœ¨ä¸‹æ¬¡æŒ‘æˆ°ä¸­ï¼Œç›®æ¨™å°‡é‡æ–°è¨­å®šï¼‰</p>
                `;
            } else {
                finalMessage = `
                    <p class="text-3xl font-black text-red-600 mb-2">éŠæˆ²çµæŸ!</p>
                    <p class="text-xl text-gray-700 mb-4">${reason}</p>
                    <p class="text-lg">ç¸½å…±åœ¨å¶ºå—åœç•™äº† <span class="text-2xl font-extrabold text-pink-600">${gameState.day}</span> å¤©ã€‚</p>
                    <p class="text-lg">ç¸½è”ææ•¸: <span class="text-2xl font-extrabold text-pink-600">${gameState.litchi}</span> é¡†</p>
                `;
            }
            
            gameAreaEl.innerHTML = `<div class="text-center p-6 w-full">${finalMessage}</div>`;

            startButton.classList.add('hidden');
            restartButton.classList.remove('hidden');
        }

        /** Displays the fruit icon clarification and difficulty form. */
        function showClarification() {
            let formHTML = `
                <div id="clarification-info" class="text-left p-4 bg-gray-50 rounded-xl shadow-md w-full max-w-xs mx-auto space-y-4">
                    
                    <!-- éŠæˆ²ç²å‹èˆ‡çè³å€å¡Š -->
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2">éŠæˆ²ç²å‹èˆ‡çè³</h3>
                    <ul class="clarification-list text-sm text-gray-700 space-y-2">
                        <li class="font-semibold text-gray-700">ğŸ† <strong class="text-green-600">æ¯æ—¥å‹åˆ©</strong>ï¼šåœ¨ 60 ç§’å…§é”æˆè”æç›®æ¨™ï¼Œå³å¯é€²å…¥ä¸‹ä¸€æ—¥æŒ‘æˆ°ã€‚é‚Šæ¡†æœƒéš¨è‘—ã€Œå››æ™‚æ˜¥ã€æ›´æ›å­£ç¯€ä¸»é¡Œã€‚</li>
                        <li class="font-semibold text-gray-700">ğŸ¥‡ <strong class="text-yellow-600">çµ‚æ¥µæˆå°±</strong>ï¼šæˆåŠŸæŒ‘æˆ°é€£çºŒ <span class="text-lg font-extrabold text-pink-600">${ULTIMATE_GOAL_DAYS}</span> å€‹å¶ºå—æ—¥å¾Œï¼Œæ‚¨å°‡ç²å¾—ã€Œä¸è¾­é•·ä½œå¶ºå—äººã€çš„ç¨±è™Ÿï¼</li>
                        <li class="font-semibold text-gray-700">ğŸ’” <strong class="text-red-600">å¤±æ•—æ¢ä»¶</strong>ï¼šç²¾åŠ›å€¼è€—ç›¡ï¼Œæˆ– 60 ç§’å…§æœªé”æˆæ¯æ—¥ç›®æ¨™ã€‚</li>
                    </ul>
                    
                    <!-- è¨­è¨ˆæºé ­èˆ‡æ¦‚å¿µå€å¡Š -->
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2 pt-2">è¨­è¨ˆæºé ­èˆ‡æ¦‚å¿µ</h3>
                    <p class="text-sm text-gray-700 leading-relaxed mb-4">
                        æœ¬éŠæˆ²éˆæ„Ÿä¾†è‡ªè˜‡è»¾çš„ã€Šæƒ å·ä¸€çµ•ã€‹ï¼š<br>
                        ã€Œç¾…æµ®å±±ä¸‹<strong class="text-emerald-600">å››æ™‚æ˜¥</strong>ï¼Œç›§æ©˜æ¥Šæ¢…<strong class="text-pink-600">æ¬¡ç¬¬æ–°</strong>ã€‚<br>
                        <strong class="text-pink-800">æ—¥å•–è”æä¸‰ç™¾é¡†</strong>ï¼Œä¸è¾­é•·ä½œå¶ºå—äººã€‚ã€
                    </p>
                    <ul class="clarification-list text-sm text-gray-700 space-y-1">
                        <li class="font-semibold text-gray-700">ğŸ“Œ <strong class="text-emerald-600">ã€Œå››æ™‚æ˜¥ã€</strong>ï¼šé‚Šæ¡†é¡è‰²éš¨æŒ‘æˆ°æ—¥è®ŠåŒ–ï¼Œè±¡å¾µå››å­£ç”Ÿæ©Ÿã€‚</li>
                        <li class="font-semibold text-gray-700">ğŸ“Œ <strong class="text-pink-600">ã€Œæ¬¡ç¬¬æ–°ã€</strong>ï¼šç©å®¶é ˆæŒ‰å›ºå®šé †åºé»æ“Šæ°´æœï¼Œé«”ç¾è±æ”¶çš„ç¯€å¥ã€‚</li>
                        <li class="font-semibold text-gray-700">ğŸ“Œ <strong class="text-pink-800">ã€Œä¸‰ç™¾é¡†ã€</strong>ï¼šæ˜¯æ¯æ—¥ç›®æ¨™ï¼Œé¼“å‹µç©å®¶å¿«é€Ÿç´¯ç©è”æã€‚</li>
                    </ul>

                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2 pt-2">æ°´æœåœ–æ¨™èªªæ˜ (Qç‰ˆ)</h3>
                    <p class="text-sm mb-1 text-gray-600 font-bold">è«‹ä¾åºé»æ“Š (æ¬¡ç¬¬æ–°): è”æ â†’ ç›§æ©˜ â†’ æ¥Šæ¢…</p>
                    <ul class="clarification-list text-base text-gray-700 space-y-2 mb-4">
                        <li class="font-semibold">ğŸ’ <span class="text-pink-600">è”æ (Litchi)</span></li>
                        <li class="font-semibold">ğŸ‘ <span class="text-amber-600">ç›§æ©˜ (æ‡æ·)</span></li>
                        <li class="font-semibold">ğŸ« <span class="text-indigo-600">æ¥Šæ¢… (Wax Apple)</span></li>
                        <li class="font-semibold">âœ¨ <span class="text-yellow-600">ç‹‚ç†±ä»™æœ</span>: é»æ“Šå¾Œé€²å…¥é«˜åˆ†æ¨¡å¼ï¼</li>
                    </ul>

                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2">éŠæˆ²ææ¡ˆèˆ‡é›£åº¦é¸æ“‡</h3>
                    <form id="difficulty-form" class="space-y-3">
            `;

            // Dynamically create radio buttons for difficulty presets
            for (const key in DIFFICULTY_PRESETS) {
                const preset = DIFFICULTY_PRESETS[key];
                const checked = key === 'su_shi' ? 'checked' : '';
                
                formHTML += `
                    <label class="flex items-start p-2 rounded-lg cursor-pointer hover:bg-gray-100 border border-gray-200">
                        <input type="radio" name="difficulty" value="${key}" ${checked} class="mt-1 form-radio text-pink-500 border-gray-300 focus:ring-pink-500">
                        <div class="ml-3">
                            <span class="font-bold text-lg ${preset.color}">${preset.label}</span>
                            <p class="text-xs text-gray-500 mt-0.5">ç›®æ¨™: ${preset.dailyGoal} é¡† | ä»™æœ: ${(preset.feverChance * 100)}% | èª¤é»: -${preset.wrongClickCost} ç²¾åŠ›</p>
                            <p class="text-xs text-gray-700 mt-1">${preset.description}</p>
                        </div>
                    </label>
                `;
            }

            formHTML += `</form></div>`;
            
            gameAreaEl.innerHTML = formHTML;

            // Add event listeners to radio buttons to update the state immediately
            document.getElementById('difficulty-form').addEventListener('change', (e) => {
                if (e.target.name === 'difficulty') {
                    applyDifficultySetting(e.target.value);
                }
            });

            // Set initial difficulty for the start button text
            applyDifficultySetting('su_shi'); 

            gameAreaEl.removeEventListener('click', handleFruitClick);
            startButton.classList.remove('hidden');
            restartButton.classList.add('hidden');
        }

        // --- Event Listeners and Initialization ---

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', () => {
            gameState.day = 0; 
            showClarification();
            gameMessageEl.textContent = 'è«‹å…ˆé¸æ“‡é›£åº¦ï¼Œç„¶å¾Œé–‹å§‹ã€Œå¶ºå—æ—¥ã€ï¼';
            updateUI();
        });

        // Initial setup
        showClarification();
        updateUI();

    </script>
</body>
</html>
